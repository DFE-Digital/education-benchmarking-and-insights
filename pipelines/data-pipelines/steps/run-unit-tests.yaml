steps:
  - bash: |
      echo "##vso[task.setvariable variable=CACHE_RESTORED]false"

  - task: UsePythonVersion@0
    inputs:
      versionSpec: '3.12'
    displayName: 'Use Python 3.12'

  - script: |
      export POETRY_VERSION=1.8.2
      curl -sSL curl -sSL https://install.python-poetry.org | python -
      export PATH=$PATH:$HOME/.poetry/bin
      poetry install --no-root
    displayName: 'Install dependencies'
    workingDirectory: data-pipeline

  - script: |
      echo "##vso[task.prependpath]$HOME/.poetry/bin"
      poetry shell
    displayName: Add poetry to PATH and set shell
    workingDirectory: data-pipeline

  - script: |
      make lint
    displayName: 'Lint'
    workingDirectory: data-pipeline

  - script: |
      make test-ci
    displayName: 'Tests'
    workingDirectory: data-pipeline

    